<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <title>表格</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/layout.css" rel="stylesheet">
    <link href="/static/css/pure-min.css" rel="stylesheet" type="text/css">
    <link href="/static/css/grids-responsive-min.css" rel="stylesheet" type="text/css">
    <script src="/static/js/jquery-3.3.1.min.js"></script>
</head>

<body>
    <div class="body_container">
        <div id="header">
            <div class="site-name">
                <div id="logo" href='#' onclick="frame.src='/page/index'">请假批阅</div>
                <p class="description">a simple demo</p>
            </div>
            <div id="nav-menu"></div>
        </div>
        <div id="layout" class="pure-g">
            <div class="pure-u-1 pure-u-md-3-4">
                <div class="content_container">
                    <iframe id="bdIframe" frameborder="0" src="/page/index" onload="updateButtons()"></iframe>
                    <script>
                        function resizeIframe() {
                            const oIframe = document.getElementById('bdIframe')
                            const deviceWidth = document.querySelector('.content_container').clientWidth
                            const deviceHeight = document.documentElement.clientHeight - 140
                            oIframe.style.width = Number(deviceWidth) + 'px' // 数字是页面布局宽度差值
                            oIframe.style.height = Number(deviceHeight) + 'px' // 数字是页面布局高度差
                        }
                        resizeIframe()
                        window.onresize = this.resizeIframe
                    </script>
                </div>
            </div>
            <div class="pure-u-1-4 hidden_mid_and_down">
                <div id="sidebar" class="profile">
                    <a class='btn btn-outline-dark' href='#' onclick="frame.src='/page/optimize'" style="font-size: medium">
                        识别优化
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    const buttons = new Map()
    const frame = document.getElementById('bdIframe')
    const menuList = document.querySelector('#nav-menu')
    function updateButtons() {
        $.ajax({
            method: 'GET',
            url: '/api/actions',
            complete: function (a) {
                buttons.clear()
                while (menuList.firstChild)
                    menuList.removeChild(menuList.firstChild);
                var res = JSON.parse(a.responseText)['content']
                if (res != null)
                    for (const i of res)
                        buttons.set(i[0], i[1])
            }
        }).then(function () {
            buttons.forEach(function (val, i) {
                var element = document.createElement('a')
                element.setAttribute('id', i)
                element.setAttribute('href', '#')
                element.innerText = val[1]
                element.onclick = (x) =>
                    frame.src = val[0]
                menuList.appendChild(element)
            })
        })
    }
    updateButtons()
</script>

</html>